mongodb:
  # MongoDB connection settings
  uri: "mongodb://localhost:27017"
  database: "inventory"
  # Collections to watch
  collections:
    - name: "products"
      watch_filter: {}  # Optional aggregation pipeline stages
      topic: "inventory-transactions-topic"
      deduplication:
        enabled: true
        memory_ttl: 3600  # 1 hour
        memory_max_size: 10000  # Maximum number of messages to keep in memory
        persistent_enabled: true
        persistent_ttl: 86400  # 24 hours
        cleanup_interval: 3600  # Clean up every hour
    - name: "transactions"
      watch_filter: {}
      topic: "inventory-updates-topic"
      deduplication:
        enabled: true
        memory_ttl: 7200  # 2 hours
        memory_max_size: 20000  # Larger cache for high-volume collection
        persistent_enabled: true
        persistent_ttl: 172800  # 48 hours
        cleanup_interval: 3600
  # Connection options
  options:
    max_pool_size: 100
    min_pool_size: 10
    max_idle_time_ms: 10000
    connect_timeout_ms: 20000
    server_selection_timeout_ms: 30000
    retry_writes: true
    w: "majority"

pubsub:
  # Google Cloud project settings
  project_id: "your-project-id"
  # Default topic settings
  default_topic_settings:
    message_retention_duration: "7d"
    message_storage_policy:
      allowed_persistence_regions:
        - "us-central1"
  # Publisher settings
  publisher:
    batch_settings:
      max_messages: 100
      max_bytes: 1048576  # 1MB
      max_latency: 0.05  # 50ms
    retry_settings:
      initial_retry_delay: 0.1
      retry_delay_multiplier: 1.3
      max_retry_delay: 60
      max_attempts: 5
    circuit_breaker:
      failure_threshold: 5  # Number of failures before opening circuit
      reset_timeout: 60.0   # Seconds to wait before attempting recovery
      half_open_max_calls: 3  # Max calls to allow in half-open state
    backpressure:
      # Token bucket settings
      tokens_per_second: 1000.0  # Base rate limit (messages/second)
      bucket_size: 2000  # Maximum burst size
      min_tokens_per_second: 100.0  # Minimum rate during heavy backpressure
      max_tokens_per_second: 5000.0  # Maximum rate during light load
      
      # Adaptive rate adjustment
      error_decrease_factor: 0.8  # Multiply rate by this on errors
      success_increase_factor: 1.1  # Multiply rate by this on success
      rate_update_interval: 5.0  # Seconds between rate adjustments
      
      # Monitoring
      metrics_window_size: 100  # Number of operations to track for metrics
  # Status topic for heartbeat messages
  status_topic: "connector-status-topic"

firestore:
  # Resume token collection settings
  collection: "resumeTokens"
  # Document TTL in seconds (30 days)
  ttl: 2592000

monitoring:
  # Structured logging settings
  logging:
    level: "INFO"
    format: "json"
    handlers:
      - type: "console"
      - type: "file"
        filename: "connector.log"
        max_bytes: 10485760  # 10MB
        backup_count: 5
    # Log sampling configuration
    sampling:
      enabled: true
      default_rate: 1.0  # Sample all logs by default
      rules:
        DEBUG:  # Rules for DEBUG level logs
          "change_event_processed":  # Rule for specific message type
            rate: 0.1  # Sample 10% of change event logs
            strategy: "probabilistic"
          "heartbeat_published":  # Rule for heartbeat messages
            rate: 0.2  # Sample 20% of heartbeat logs
            strategy: "rate_limiting"
            ttl: 3600  # Clean up rate limiting cache after 1 hour
        INFO:
          "batch_published":  # Rule for batch publishing logs
            rate: 0.5  # Sample 50% of batch logs
            strategy: "probabilistic"
          "circuit_breaker_state_change":  # Rule for circuit breaker logs
            rate: 1.0  # Sample all circuit breaker state changes
            strategy: "deterministic"
  # OpenTelemetry settings
  tracing:
    service_name: "mongo-connector"
    endpoint: "localhost:4317"

health:
  # Health check settings
  endpoints:
    health: "/health"
    readiness: "/readiness"
    metrics: "/metrics"
  # Readiness probe settings
  readiness:
    timeout: 5
    interval: 30
    failure_threshold: 3
  # Heartbeat settings
  heartbeat:
    interval: 30  # seconds
    enabled: true

retry:
  # Connection retry settings
  initial_delay: 1.0
  max_delay: 60.0
  multiplier: 2.0
  jitter: 0.1
  max_retries: 10 